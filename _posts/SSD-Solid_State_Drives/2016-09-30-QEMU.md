---
layout: post
title: QEMU(Generic and Open Source Machine emulator and Virtualizer)
subtitle: What is the QEMU ? and how can I install QEMU on CentOS 7?
css:
tags:
date:
big-image:
share-image:
permalink:
comments:
show-share:
big-image:
meta-title:
meta-description:
---

Some feature is needed to use the evironment of Virtualiztion and emulator. 

The Following article introduces yout about [QEMU(generic and open source machine adn virtualizer)](http://wiki.qemu.org/Main_Page)

I think you need to know Hypervisor and KVM Befor seeing the QEMU. 

# Hypervisor

 A hypervisor or virtual machine monitor(VMM) is a piece of of computer software, firmware or hardware that creates and runs virtual machines.  
 
 A computer on which a hypervisor runs one or more virtual machines is called a host machine, and each virtual machine is called a gues machine.
 
 The hypervisor presents the guest operating systems with a virtual operating platform and manages the execution of the guest operating systems. Mutiple instances of a variety of operating systems may share the virtualized hardware resources :
 
 For example, Linux, windows, And OS x instances can all run on a single physical x86 Machine. This Contrasts with operating-system-level-virtualization, where all instances (usually called containers) must share a single kernel, though the guest operating systems can differ in user space.
 
![](/img/Image/SSD-Solid_State_Drives/2016-09-30-QEMU/hypervisor.png)

 As you can see the above figure, hypervisor has two types. 
 
## Type-1, native or bare-metal hypervisors. 

 These hypervisors run directly  on the host's hardware to control the hardware and to manage guest operating systems. For this reason, they are sometimes called bare metal hypervisors. 

## Type-2 or hosted hypervisors. 

 These hypervisors run on a conventional operating system just as other computer programs do, A guest operating system runs as a process on the host. Type-2 hypervisors abstract guest operating systems from the host operating system.
 
 **QEMU is example of type-2 hypervisors.**
 
 If you want to know about hypervisor in detail. I recommend you [wikipedia's hypervisor](https://en.wikipedia.org/wiki/Hypervisor)
 
# [KVM](https://en.wikipedia.org/wiki/Kernel-based_Virtual_Machine), what is the KVM

  KVM (Kernel-based Virtual Machine) is a virtualization infrastructure for the Linux kernel that turn it into a a hypervisor.
 
  But, KVM requires a processor with hardware virtualization extexsions.
  
<!-- When I make the new Gitpage, The following picture is added -->
  
  ![](/img/Image/SSD-Solid_State_Drives/2016-09-30-QEMU/Kernel-based_Virtual_Machine.png)
  
  By itself, KVM does not perform any emulation, Instead, It exposes the /dev/kvm interface, which a user space host can then use to :
  
    - Set up the quest VM's address space. the host must also supply a firmware image (usually a custom BIOS when emulating PCs) that the gues can use to bootstrap into its main OS.
    
    - Feed the guest simulated I/O. 
    
    - Map the guest's video display Back onto the host. 
   
  On Linux, QMEU versions 0.10.1 and later is one such userspace host. QEMU uses KVM When available to vitualize guest at near-native speeds, but otheriwse falls back to software-only emulation.
 
  And according to [the official QEMU site's KVM explanation](http://wiki.qemu.org/KVM),
  
  KVM (Kernel Virtual Machine) is a Linux kernel module that allows a user space program to utilize the hardware virtualization feature of various processors. 
  
  Also QEMU can make use of KVM when running a target architecture that is the same as the host architecture. For instance, When runnig qemu-system-x86 on an x86 compatible processor, You can take advantage of the KVM acceleration that gives you benefit for your host and your guest system.
 
  If you want to know if your CUP support KVM, type as follows. 
  
```Shell
$ egrep '(vmx|svm)' /proc/cpuinfo OR $ grep -e 'vmx' /proc/cpuinfo
- If you see result of the grep command with linenumber. type like
$ grep -nri "vmx" /proc/cpuinfo
```

  On My CentOS 7 and x86 system
  
  ![](/img/Image/SSD-Solid_State_Drives/2016-09-30-QEMU/grep_-e_vmx.png)
  
<!--
the result of the above commad,$ grep -nri "vmx" /proc/cpuinfo. 
20:flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx est tm2 ssse3 fma cx16 xtpr pdcm pcid sse4_1 sse4_2 movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm arat epb pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt
46:flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx est tm2 ssse3 fma cx16 xtpr pdcm pcid sse4_1 sse4_2 movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm arat epb pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt
72:flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx est tm2 ssse3 fma cx16 xtpr pdcm pcid sse4_1 sse4_2 movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm arat epb pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt
98:flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx est tm2 ssse3 fma cx16 xtpr pdcm pcid sse4_1 sse4_2 movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm arat epb pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt ThinkServer TS140
-->

# [QEMU](http://wiki.qemu.org/Main_Page) 

  reference : [The Official QEMU site](http://wiki.qemu.org/Main_Page), [WikiBooks's QEMU](https://en.wikibooks.org/wiki/QEMU)

  QEMU is a generic and open source machine emulator and virtualizer. 

  When used  as a machine emulator, QEMU can run OSes and programs made for one machine (e.g.an ARM board) on a different machine (e.g. your own PC). By using dynamic translation, it achieves very good performance. 

  When used as a virtualizer, QEMU achieves near native performance by executing the guest code directly on the host CPU, QEMU supports virtualization when executing under **The Xen hypervisor or using the KVM kernel module in Linux**

## [How to Install QEMU](http://wiki.qemu.org/Documentation/GettingStartedDevelopers)

  my environment of installing QEMU is CentOS 7. On the Centos 7, Normally, When you install the QEMU, You can use source code from officail git repository. 

  If you want to know process of installing QEMU from git repository and  how to set QEMU on a couple of host enviromnets, I recommand [Documentation/GettingStartedDevelopers](http://wiki.qemu.org/Documentation/GettingStartedDevelopers) of QEMU wiki.

  But, If your operating system is Centos 7(Linux), I recommand [QEMU wiki's host linux](http://wiki.qemu.org/Hosts/Linux)

  **But From now on, I will explain to you how to start QEMU with GUI**

  Especially, with QEMU-KVM On CentOS 7, As you can see [this Wikibooks's Installing QEMU-KVM](https://en.wikibooks.org/wiki/QEMU/Installing_QEMU), 
  
  **QEMU by itself isn't very fast, as it does a lot of emulation even when running on the hardware compatible with the guest operating system.**
  
## [How to install QEMU-KVM](https://en.wikibooks.org/wiki/QEMU/Installing_QEMU)  

  From now on, I will install QEMU-KVM on CentOS 7.

  Let's start the installation of QEMU-KVM on CentOS 7.
  
  KVM stands for Kernel Based Virtual Machine, is a virtualiztion software whicj provides ability to run a multiple guest operating systems with the help of hardware virtualization extensions. It supports wide variety of geust operating system's such as Linux, Windows, Solaris, Haiku, REACT OS and much more. 
  
  KVM can be managed using command line or available graphical tool. **Virt-Manager ( Virtual Manchine Manager )** is used to manage KVM based virtual machines.
  
  **Be aware of the following that explain virt,"Open Source API"**
 
  for virt-manager, virsh, OpenStack, Ovirt, if you want to konw more, please use [libvirt](https://en.wikipedia.org/wiki/Libvirt) and [another libvirt site](http://libvirt.org/drvqemu.html).
  
  libvirt is an open source API, deamon and management tool for managing platform virtualization, It can be used to manage KVM, Xen, VMware ESX, QEMU and other virtauliztion Thechnologies.
  
  ![](/img/Image/SSD-Solid_State_Drives/2016-09-30-QEMU/libvirt.png)
  
### Pre-requisites Befor installing QEMU-KVM  

  As said earlier, KVM will appear only if the CPU has a support of hardware virtualization, either Inter VT or AMD-V. 
  
  So If You want to find whether your CPU supports VT features, run the following command.
  
  > What is the /proc/cpuinfo ?  
  > If you want to know, Click [What is the /proc/cpuinfo?](https://www.centos.org/docs/5/html/5.1/Deployment_Guide/s2-proc-cpuinfo.html)  
  > To sum up the above site, /proc/cpuinfo means this virtual file identifies the type of processor used by your system

  The site that I refer to for installing QEMU-KVM say as follows

  > **$ egrep '(vmx|svm)' /proc/cpuinfo**
  
  But, In my case, 
  
  > **#grep -e 'vmx' /proc/cpuinfo**
  
  ![](/img/Image/SSD-Solid_State_Drives/2016-09-30-QEMU/grep_-e_vmx.png)
  
<!--
the result of the above commad,$ grep -nri "vmx" /proc/cpuinfo. 
20:flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx est tm2 ssse3 fma cx16 xtpr pdcm pcid sse4_1 sse4_2 movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm arat epb pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt
46:flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx est tm2 ssse3 fma cx16 xtpr pdcm pcid sse4_1 sse4_2 movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm arat epb pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt
72:flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx est tm2 ssse3 fma cx16 xtpr pdcm pcid sse4_1 sse4_2 movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm arat epb pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt
98:flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx est tm2 ssse3 fma cx16 xtpr pdcm pcid sse4_1 sse4_2 movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm arat epb pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid xsaveopt ThinkServer TS140
-->

  If you issue the above command, you can check if your hardware support Virtual Enxtension with other information.
  
### Install QEMU-KVM

  Please issue tha following command to install latest qemu package and also virt-manager which provides graphical interface to manage virtual machines.
  
  > $ sudo yum install qemu-kvm qemu-img virt-manager libvirt libvirt-python libvirt-client virt-install virt-viewer  
  
```
  **qemu-kvm** means QEMU emulator  
  **qemu-img** means QEMU disk image manager  
  **vir-install** means Command line tool to create virtual machines.  
  **libvirt-client** means providing client side API's for accessing servers and also provides virsh utility which provides command line tool to manage virtual machines.
  **virt-viewer** means Graphical console.  --> I think if you don't install this tool. virt-mangaer will work. 
```

  **After you install the above things, You can use virt-manager(QEMU-KVM graphic tool),and command tool together**
  
  I will summarize two ways to install QEMU-KVM.
  
#### Creating Virtual Machine

  Once You have installed QEMU-KVM and other tools, it is all set to start creating virtual machines. We will be looking at creating virtual machines in both command line and graphical mode.
  
##### Command Line Mode 

  **virt-install** is used to create virtual machines using command line, this command needs multiple inputs from us to create a virtual machine such as CPU, Memory, Disk, network, Installation media location, os variant and more.

  For example of command line, 
  
  > $ sudo virt-install  --name=itzgeekguest  --ram=1024  --vcpus=1  --cdrom=/tmp/CentOS-6.5-x86_64-minimal.iso --os-type=linux --os-variant=rhel6  --network bridge=br0 --graphics=spice  --disk path=/var/lib/libvirt/images/itzgeekguest.dsk,size=4
  
  The above command uses bridged networking "br0" for allowing virtual machines to communicate with outside network, you can find a tutorial on creating bridged networking with virt Manager.
  
```
   -**name** means Name of the virtual Machine.  
   -**ram** means Memory size in MB  
   -**vcpus** means virtal cpu's in numbers  
   -**cdrom** means Location of the ISO image.  
   -**os-type** means OS type like Linux, Windows and Unix  
   -**os-variant** means OS variant like rhel 6, solaris   
   -**networking** means Networking
   -**graphics** means Guest display settings
   -**disk path** means Location of the disk with size of 4GB
```
  
   I will finish using command line, Becaue I will use Graphic tool, **virt-manager.**
   
   But, remember the above way, If you evaluation OpenChannelSSD with QEMU-NVMe. it's similiar.
   
  **From now on, I will use graphic mode for executing QEMU-KVM with virt-manager tool.**
  
  **If you use QEMU, I wish you execute QEMU-KVM with GUI than command Line.**
  
##### Graphical Line Mode, 

  At first, You have to insatll tools for executing QEMU-KVM as I do with command Line
  
  > $ sudo yum install -y qemu-kvm qemu-img virt-manager libvirt libvirt-python libvirt-client virt-install (virt-viewer)

  **though you don't install virt-viewer, virt-manager works. but in detail, I don't know what is wrong**
  
  Now, In order to execute CUI mode of QEMU-KVM
  
  > $ sudo virt-manager
  
  OR, search for Virtual Machine Manager like this 
  
  > **# Application -> System Tools -> Virtual Machine Manager**
  
  The above command means executing virt-manager to manage virtualization of hardware. 
  
  Now, you can get GUI to control QEMU-KVM from installation to setting of Virtual Hardware.  
  
  **Even if you foget to install tools to need to use QEMU-KVM, After executing Virt-Manager. You get help like this**
  
  ![](/img/Image/SSD-Solid_State_Drives/2016-09-30-QEMU/my qemu-nvme for OpenChannelSSD error right after virt-manager.png)
   
   **OR**
   
   ![](/img/Image/SSD-Solid_State_Drives/2016-09-30-QEMU/my qemu-nvme for OpenChannelSSD error right after virt-manager0-1.png)
  
  if you are in the above situation, don't get afraid !, **press button to install**
  
  **Be careful, Befor executing your Virt-Manage tool like this**
  
  BUT, If you don't check to verify the 'libvirtd' daemon is running, you can get the below pictures.
  
  The following is after pressing the install button.
  
  **Anotere careful point**
  
  If you don't check to verify the 'libvirtd' daemon is running, you can get the below pictures.
  
  ![](/img/Image/SSD-Solid_State_Drives/2016-09-30-QEMU/virt-manager_after_not_to_check_daemon_is_running.png)
   
  ![](/img/Image/SSD-Solid_State_Drives/2016-09-30-QEMU/error when executing the virt-manager.png)
  
  And If you want to check if the above thing is true, You can check the status of 'libvirtd' daemon with **"systemctl"** command.
  
  > $ systemctl status libvirtd
  
  ![](/img/Image/SSD-Solid_State_Drives/2016-09-30-QEMU/systemctl status libvirtd.png)
  
  let's run **libvirtd daemon**!
  

# Reference 

 - [Wikipedia's Hypervisor](https://en.wikipedia.org/wiki/Hypervisor)
 
 - [Wikipedia's KVM](https://en.wikipedia.org/wiki/Kernel-based_Virtual_Machine)
 
 - [The Official QEMU site's KVM](http://wiki.qemu.org/KVM)
 
 - [The Official QEMU site](http://wiki.qemu.org/Main_Page)
 
 - [wikiBooks's QEMU](https://en.wikibooks.org/wiki/QEMU)
 
 - [Wikibooks's Installing QEMU-KVM](https://en.wikibooks.org/wiki/QEMU/Installing_QEMU)
 
 - QEMU-KVM installation that I refered to
   
   - [itzgeek site](http://www.itzgeek.com/how-tos/linux/centos-how-tos/install-kvm-qemu-on-centos-7-rhel-7.html) in November 25, 2014
   
   - [jensd](http://jensd.be/207/linux/install-and-use-centos-7-as-kvm-virtualization-host) written in August 27, 2014
   
   - [tecmint](http://www.tecmint.com/install-and-configure-kvm-in-linux/)
   
  - [Wikipedia's libvirt](https://en.wikipedia.org/wiki/Libvirt)
  
  - [libvirt.org](http://libvirt.org/drvqemu.html)
